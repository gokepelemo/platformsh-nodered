name: app
type: nodejs:16

disk: 2048

dependencies:
  nodejs:
    'npm': '*'

hooks:
  build: |
    set -e
    npm install -g --unsafe-perm node-red

web:

  # Add a web location for a static site in the public directory. Not necessary if the / path is served by node-red's http in node.
  locations:
    '/':
      root: 'public'
      allow: true
      scripts: false
      index: ['index.html']
      rules:
        '\.(jpe?g|png|gif|svgz?|css|js|map|ico|bmp|eot|woff2?|otf|ttf)$':
          allow: true
          expires: 30m

  commands:
    start: |
      node-red -p $PORT -D httpAdminRoot=$EDITOR -D httpStatic=$EDITOR

mounts:

  # A writable mount for the node-red user directory.
  '/.node-red':
    source: local
    source_path: 'node-red'

  # A writable mount for the public directory. Not necessary if the / path served by node-red http in node.
  #'/public':
  #  source: local
  #  source_path: 'public'

  # A writable mount for static files that are generated by node-red and can be shared between workflows. 
  '/files':
    source: local
    source_path: 'files'

variables:
  env:
    'NODE_OPTIONS': '--max-old-space-size=512'
